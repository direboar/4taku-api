name: create-release-pullrequest

on:
  push:
    branches:
      - main
  workflow_dispatch:

env:
  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

jobs:
  create-pr:
    runs-on: ubuntu-20.04

    steps:
      - name: Checkout ğŸ›
        uses: actions/checkout@master

      - name: Check if pr exists
        id : check_pr
        run: echo "::set-output name=count::$(gh pr list -S ãƒªãƒªãƒ¼ã‚¹ç”¨ã®PullRequestã§ã™ã€‚in:title | wc -l)"

      - name: Create release pr
        if: ${{ steps.check_pr.outputs.count == 0 }}
        run: |
         gh pr create --head main --base production --title ãƒªãƒªãƒ¼ã‚¹ç”¨ã®PullRequestã§ã™ã€‚ --body productionã«ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹å ´åˆã€ã“ã®PullRequestã‚’ãƒãƒ¼ã‚¸ã—ã¦ãã ã•ã„ã€‚
        env:
          AUTHOR: ${{ github.event.pusher.name }}

      - name: Discord Message Notify
        if: ${{ steps.check_pr.outputs.count == 0 }}
        uses: appleboy/discord-action@0.0.3
        with:
          webhook_id: ${{ secrets.DISCORD_WEBHOOK_ID }}
          webhook_token: ${{ secrets.DISCORD_WEBHOOK_TOKEN }}
          color: "#48f442"
          username: "GitHub Bot[4taku-frontend]"
          args: |
              ãƒªãƒªãƒ¼ã‚¹ç”¨ã®PullRequestã‚’ä½œæˆã—ã¾ã—ãŸã€‚
              https://github.com/direboar/4taku-api/pulls/
              ãƒˆãƒªã‚¬ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ:${{ github.event_name }} 
